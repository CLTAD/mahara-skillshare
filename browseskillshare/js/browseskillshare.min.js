(function(g,a){function m(){a(".listing").each(function(){var d=a(this).attr("name");a(".exampleimages",this).click(function(){i(parseInt(d))});a(".viewmore",this).click(function(){i(parseInt(d))})})}function j(d,e){var f=!1,b="#skillsharefilter_"+d;if("sharetype"==d||"college"==d)b+=e;a('.filterentry[name="'+d+'"]').each(function(){if(a(this).attr("value")==e)return f=!0,!1});if(f)return!1;var c=a("<div>").addClass("filterentry");if("keyword"==d)e.length&&(c.html(e),c.attr("name",d),c.attr("value", e),k(b,c));else if("course"==d){if(e.length){var h={autocomplete:1,field:"courseid",term:a(b).val()};sendjsonrequest(config.wwwroot+"artefact/browseskillshare/autocomplete.json.php",h,"POST",function(e){c.html(a(b).val());c.attr("name",d);c.attr("value",e.courseid);k(b,c)})}}else c.html(a(b).prev("label").find(".ui-button-text").html()),c.attr("name",d),c.attr("value",a(b).val()),k(b,c)}function k(d,e){if(a(d).val().length){a("#activefilters").append(e);var f=a(".removefilter input").clone(),b=a("<div>").addClass("removefilterentry"); b.attr("name",e.attr("name"));b.attr("value",a(d).val());b.append(f);a("#activefilters").append(b);a("#activefilters").append(a("<div>").addClass("clearfix"));f.click(function(){var b=f.parent(".removefilterentry");if("sharetype"==a(b).attr("name")||"college"==a(b).attr("name")){var c="#skillsharefilter_"+a(b).attr("name")+a(b).val();a(c).length&&(a(c)[0].checked=!1,a(c).button("option","icons",{secondary:"ui-icon-circle-plus"}),a(c).button("refresh"))}else"course"==a(b).attr("name")?a("#skillsharefilter_course").val(""): "keyword"==a(b).attr("name")&&a("#skillsharefilter_keyword").val("");b.prev().remove();b.remove();2>a("#activefilters .filterentry").length&&(a("#removeallfilterentries").remove(),a("#removeallbutton").remove());g.filter_content()});f.hover(function(){a(this).parent().addClass("ui-state-hover")},function(){a(this).parent().removeClass("ui-state-hover")});if(2==a("#activefilters .filterentry").length){var b=a("<div>").attr("id","removeallfilterentries"),c=a("<div>").attr("id","removeallbutton").addClass("removefilterentry"), h=a(".removefilter input").clone();b.attr("name","removeall");b.attr("value","removeall");b.html("Clear all filter entries");c.append(h);a("#activefilters").prepend(a("<div>").addClass("clearfix"));a("#activefilters").prepend(c);a("#activefilters").prepend(b);h.click(function(){a(".filterentry").each(function(){var b="#skillsharefilter_"+a(this).attr("name")+a(this).val();a(b).length&&(a(b)[0].checked=!1,a(b).button("option","icons",{secondary:"ui-icon-circle-plus"}),a(b).button("refresh"))});a("#activefilters .removefilterentry, #activefilters .filterentry").each(function(){a(this).remove()}); a("#removeallfilterentries").remove();a("#skillsharefilter_course").val("");a("#skillsharefilter_keyword").val("");g.filter_content()});h.hover(function(){a(this).parent().addClass("ui-state-hover")},function(){a(this).parent().removeClass("ui-state-hover")})}}g.filter_content()}function i(d){History.getState().url!=config.wwwroot+"artefact/browseskillshare/listing-"+d&&(a.browser.msie?History.pushState(null,null,"/listing-"+d):History.pushState(null,"Skillshare listing",config.wwwroot+"artefact/browseskillshare/listing-"+ d));sendjsonrequest(config.wwwroot+"artefact/browseskillshare/skillsharefullscreen.json.php",{fullscreen:1,id:d},"POST",function(d){var f=a("<div>").attr("id","skillsharefullscreen").html(d.data.html);f.addClass("hidden");a("body").prepend(a("<div>").attr("id","overlay"));a("body").append(f);f.removeClass("hidden");f.css("z-index",9998);a("div.content").css("display","block");a("#thumbs ul.thumbs li").opacityrollover({mouseOutOpacity:0.67,mouseOverOpacity:1,fadeSpeed:"fast",exemptionSelector:".selected"}); a("#thumbs").galleriffic({delay:2500,numThumbs:4,preloadAhead:4,enableTopPager:!1,enableBottomPager:!1,imageContainerSel:"#slideshow",controlsContainerSel:"#controls",captionContainerSel:"#caption",loadingContainerSel:"#loading",renderSSControls:!0,renderNavControls:!1,playLinkText:"play slideshow",pauseLinkText:"pause slideshow",prevLinkText:"&lsaquo; previous",nextLinkText:"next &rsaquo;",nextPageLinkText:"Next &rsaquo;",prevPageLinkText:"&lsaquo; Prev",enableHistory:!0,autoStart:!1,syncTransitions:!0, defaultTransitionDuration:900,onSlideChange:function(a,c){this.find("ul.thumbs").children().eq(a).fadeTo("fast",0.67).end().eq(c).fadeTo("fast",1)},onPageTransitionOut:function(a){this.fadeTo("fast",0,a)},onPageTransitionIn:function(){var a=this.find("a.prev").css("visibility","hidden"),c=this.find("a.next").css("visibility","hidden");0<this.displayedPage&&a.css("visibility","visible");a=this.getNumPages()-1;this.displayedPage<a&&c.css("visibility","visible");this.fadeTo("fast",1)}});a("#overlay").click(function(){f.remove(); a(this).remove();History.back()});a("#closelisting").click(function(){a("#skillsharefullscreen").remove();a("#overlay").remove();History.back()})})}var l;g.filter_content=function(d){var d="undefined"!==typeof d?d:0,e={};a("#activefilters .filterentry").each(function(){var b=a(this).attr("name"),c=a(this).attr("value");e[b]=e[b]&&-1==e[b].indexOf(c)?e[b]+(","+c):c});var f={filter:1,offset:d};a.each(e,function(a,c){f[a]=c});l.removeClass("hidden");sendjsonrequest(config.wwwroot+"artefact/browseskillshare/browseskillshare.json.php", f,"POST",function(b){l.addClass("hidden");a("#skillsharelistings").replaceWith(b.data.tablerows);a("#pagination").html(b.data.pagination);m()})};a(document).ready(function(){l=a("#loadingmessage");m();a("#skillsharefilter_keyword, #skillsharefilter_course").keypress(function(b){if(13==(b.keyCode?b.keyCode:b.which?b.which:b.charCode))b.preventDefault(),b.stopPropagation(),j(a(this).attr("name"),a(this).val())});a(".addtextfilterbutton").each(function(){var b=a(this);b.click(function(c){c.preventDefault(); var d=a(b).val(),e=a(b).prev("input").val();j(d,e);c.stopPropagation()})});var d={autocomplete:1,field:"course"};a("#skillsharefilter_course").autocomplete({minLength:2,source:function(a,c){d.term=a.term;sendjsonrequest(config.wwwroot+"artefact/browseskillshare/autocomplete.json.php",d,"POST",function(a){c(a.courses)})}});a("input.checkbox").button({icons:{secondary:"ui-icon-circle-plus"}}).click(function(){if(a(this).is(":checked")){a(this).button("option","icons",{secondary:"ui-icon-circle-close"}); var b=a(this).closest(".filtersection").attr("id"),c="college";0<=b.indexOf("sharetype")&&(c="sharetype");b=a(this).val();j(c,b)}else{a(this).button("option","icons",{secondary:"ui-icon-circle-plus"});b=a(this).closest(".filtersection").attr("id");c="college";0<=b.indexOf("sharetype")&&(c="sharetype");var b=a(this).val(),d=c,e=b;a(".filterentry").filter(function(){return a(this).attr("name")==d&&a(this).val()==e}).remove();a(".removefilterentry").filter(function(){return a(this).attr("name")==d&& a(this).val()==e}).remove();2>a("#activefilters .filterentry").length&&(a("#removeallfilterentries").remove(),a("#removeallbutton").remove());g.filter_content()}});var e=window.History;if(e.enabled){e.Adapter.bind(window,"statechange",function(){a("#messages")[0]&&a("#messages").remove();a("#skillsharefullscreen")[0]&&a("#skillsharefullscreen").remove();a("#overlay")[0]&&a("#overlay").remove()});var f=e=History.getHash();e.length||(f=a(location).attr("pathname"));e=f.substr(f.lastIndexOf("listing-")+ 8);!isNaN(parseFloat(e))&&isFinite(e)&&i(e)}})})(window.BrowseManager=window.BrowseManager||{},jQuery);